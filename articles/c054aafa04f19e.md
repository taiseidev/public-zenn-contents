---
title: "Flutterã¨Jetpack Composeã§ã®çŠ¶æ…‹é…ç½®ã®é•ã„"
emoji: "ğŸˆ"
type: "tech"
topics:
  - "android"
  - "flutter"
  - "mobile"
  - "jetpackcompose"
published: true
published_at: "2024-12-31 13:45"
---

## ã¯ã˜ã‚ã«

Flutterã¨Jetpack Composeã¯ã©ã¡ã‚‰ã‚‚å®£è¨€çš„UIã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€è¨˜è¿°æ–¹æ³•ã¯ä¼¼ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€Jetpack Composeã‚’å­¦ç¿’ã—ã¦ã„ãä¸­ã§çŠ¶æ…‹ã‚’è¦ªã«ç½®ãã¹ãã‹ã€å­ã«ç½®ãã¹ãã‹ã¨ã„ã†ç‚¹ã§æ¨å¥¨ã•ã‚Œã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒç•°ãªã‚‹ã“ã¨ã«æ°—ä»˜ã„ãŸãŸã‚ã€æœ¬è¨˜äº‹ã§æ•´ç†ã—ã¦ã„ãã¾ã™ã€‚

ã“ã®è¨˜äº‹ã¯ã€Flutterã‚„Jetpack Composeã‚’å­¦ã³å§‹ã‚ãŸæ–¹ã€ã‚ã‚‹ã„ã¯ã©ã¡ã‚‰ã‹ã®çµŒé¨“ãŒã‚ã‚Šã‚‚ã†ä¸€æ–¹ã‚’ã“ã‚Œã‹ã‚‰å­¦ç¿’ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹æ–¹ã‚’å¯¾è±¡ã¨ã—ã¦ã„ã¾ã™ã€‚

## Flutterã«ãŠã‘ã‚‹çŠ¶æ…‹é…ç½®

### åŸºæœ¬çš„ãªè€ƒãˆæ–¹
Flutterã§ã¯ã€çŠ¶æ…‹ã‚’ãªã‚‹ã¹ãæœ«ç«¯ã®Widgetï¼ˆå­ï¼‰ã«é…ç½®ã—ã€è¦ªWidgetã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ãªã‚¯ãƒ©ã‚¹ã¨ã—ã¦è¨­è¨ˆã™ã‚‹ã®ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã¡ã‚‰ã¯[StatefulWidget](https://arc.net/l/quote/mlftgfil)ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

> Push the state to the leaves. For example, if your page has a ticking clock, rather than putting the state at the top of the page and rebuilding the entire page each time the clock ticks, create a dedicated clock widget that only updates itself.

ç¿»è¨³ï¼šçŠ¶æ…‹ã‚’ãƒªãƒ¼ãƒ•[^1]ã«ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚ä¾‹ãˆã°ã€ã‚ãªãŸã®ãƒšãƒ¼ã‚¸ã«æ™‚ã‚’åˆ»ã‚€æ™‚è¨ˆãŒã‚ã‚‹å ´åˆã€çŠ¶æ…‹ã‚’ãƒšãƒ¼ã‚¸ã®ãƒˆãƒƒãƒ—ã«ç½®ãã€æ™‚è¨ˆãŒæ™‚ã‚’åˆ»ã‚€ãŸã³ã«ãƒšãƒ¼ã‚¸å…¨ä½“ã‚’å†æ§‹ç¯‰ã™ã‚‹ã®ã§ã¯ãªãã€ãã‚Œè‡ªä½“ã‚’æ›´æ–°ã™ã‚‹å°‚ç”¨ã®æ™‚è¨ˆã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

https://api.flutter.dev/flutter/widgets/StatefulWidget-class.html

ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€æ¬¡ã®ã‚ˆã†ãªãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š

- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å‘ä¸Š**ï¼šè¦ªã«çŠ¶æ…‹ã‚’æŒãŸã›ã‚‹ã¨ã€çŠ¶æ…‹ãŒå¤‰åŒ–ã—ãŸéš›ã«è¦ªã‚’ä»‹ã—ãŸå…¨ã¦ã®å­WidgetãŒãƒªãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€æœ«ç«¯ã«çŠ¶æ…‹ã‚’é…ç½®ã™ã‚‹ã“ã¨ã§ã€å½±éŸ¿ç¯„å›²ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
- **è²¬ä»»ç¯„å›²ã®æ˜ç¢ºåŒ–**ï¼šçŠ¶æ…‹ãŒå¿…è¦ãªWidgetã«ç›´æ¥ç´ä»˜ã‘ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ãŒå‘ä¸Šã™ã‚‹ã€‚

### ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
ä»Šå›ã¯ç°¡å˜ãªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦èª¬æ˜ã—ã¾ã™ã€‚
ä»¥ä¸‹ã¯çŠ¶æ…‹ã‚’è¦ªWidgetã«é…ç½®ã—ãŸä¾‹ã§ã™ï¼š

```dart
// ignore_for_file: avoid_print

import 'package:flutter/material.dart';

class ParentWidget extends StatefulWidget {
  const ParentWidget({super.key});

  @override
  State<ParentWidget> createState() => _ParentWidgetState();
}

class _ParentWidgetState extends State<ParentWidget> {
  int _counter1 = 0;
  int _counter2 = 0;

  void _incrementCounter1() {
    setState(() {
      _counter1++;
    });
  }

  void _incrementCounter2() {
    setState(() {
      _counter2++;
    });
  }

  @override
  Widget build(BuildContext context) {
    print('parent rebuild');
    return Scaffold(
      appBar: AppBar(
        backgroundColor: Theme.of(context).colorScheme.inversePrimary,
        title: const Text('AppBar'),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Child1Widget(counter: _counter1),
            ElevatedButton(
              onPressed: _incrementCounter1,
              child: const Text('increment counter1'),
            ),
            Child2Widget(counter: _counter2),
            ElevatedButton(
              onPressed: _incrementCounter2,
              child: const Text('increment counter2'),
            ),
          ],
        ),
      ),
    );
  }
}

class Child1Widget extends StatelessWidget {
  const Child1Widget({
    super.key,
    required this.counter,
  });

  final int counter;

  @override
  Widget build(BuildContext context) {
    print('child1 rebuild');
    return Text('child1: $counter');
  }
}

class Child2Widget extends StatelessWidget {
  const Child2Widget({
    super.key,
    required this.counter,
  });

  final int counter;

  @override
  Widget build(BuildContext context) {
    print('child2 rebuild');
    return Text("child2: $counter");
  }
}

```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§count1ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ã¨ã€è¦ªWidgetã®ãƒªãƒ“ãƒ«ãƒ‰ã‚’æ¤œçŸ¥ã—ã¦child2ã¾ã§ãƒªãƒ“ãƒ«ãƒ‰ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚

```terminal
flutter: parent rebuild
flutter: child1 rebuild
flutter: child2 rebuild
```

Child2WidgetãŒé™çš„ãªWidgetã§ã‚ã‚Œã°[constã‚’ä½¿ã†](https://qiita.com/chooyan_eng/items/ec11f6dcf714f7a2fa3d#const-%E3%82%92%E4%BD%BF%E3%81%86)ã“ã¨ã«ã‚ˆã£ã¦ãƒªãƒ“ãƒ«ãƒ‰ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://qiita.com/chooyan_eng/items/ec11f6dcf714f7a2fa3d#const-%E3%82%92%E4%BD%BF%E3%81%86


ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯ã•ã»ã©å½±éŸ¿ã¯ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ãŒã€è¦æ¨¡ãŒå¤§ãã„ã‚¢ãƒ—ãƒªã®å ´åˆã€ç„¡é§„ãªãƒªãƒ“ãƒ«ãƒ‰ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«ã‹ãªã‚Šã®å½±éŸ¿ã‚’ä¸ãˆã¦ã—ã¾ã„ã¾ã™ã€‚

ä»¥ä¸‹ã¯çŠ¶æ…‹ã‚’æœ«ç«¯ã®å­Widgetã«é…ç½®ã—ãŸä¾‹ã§ã™ï¼š

```dart
// ignore_for_file: avoid_print

import 'package:flutter/material.dart';

class ParentWidget extends StatelessWidget {
  const ParentWidget({super.key});

  @override
  Widget build(BuildContext context) {
    print('parent rebuild');
    return Scaffold(
      appBar: AppBar(
        backgroundColor: Theme.of(context).colorScheme.inversePrimary,
        title: const Text('AppBar'),
      ),
      body: const Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Child1Widget(),
            Child2Widget(),
          ],
        ),
      ),
    );
  }
}

class Child1Widget extends StatefulWidget {
  const Child1Widget({super.key});

  @override
  State<Child1Widget> createState() => _Child1WidgetState();
}

class _Child1WidgetState extends State<Child1Widget> {
  int _counter = 0;

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    print('child1 rebuild');
    return Column(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        Text('child1: $_counter'),
        ElevatedButton(
          onPressed: _incrementCounter,
          child: const Text('Increment Counter1'),
        ),
      ],
    );
  }
}

class Child2Widget extends StatefulWidget {
  const Child2Widget({super.key});

  @override
  State<Child2Widget> createState() => _Child2WidgetState();
}

class _Child2WidgetState extends State<Child2Widget> {
  int _counter = 0;

  void _incrementCounter() {
    setState(() {
      _counter++;
    });
  }

  @override
  Widget build(BuildContext context) {
    print('child2 rebuild');
    return Column(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        Text('child2: $_counter'),
        ElevatedButton(
          onPressed: _incrementCounter,
          child: const Text('Increment Counter2'),
        ),
      ],
    );
  }
}

```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§count1ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ã¨ã€child1ã®ã¿ãƒªãƒ“ãƒ«ãƒ‰ã•ã‚Œã€ç„¡é§„ãªãƒªãƒ“ãƒ«ãƒ‰ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã—ãŸã€‚

```terminal
flutter: child1 rebuild
```

## Jetpack Composeã«ãŠã‘ã‚‹çŠ¶æ…‹é…ç½®

### åŸºæœ¬çš„ãªè€ƒãˆæ–¹
Jetpack Composeã§ã¯ã€è¦ªã«çŠ¶æ…‹ã‚’é…ç½®ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã€çŠ¶æ…‹ã‚’ä¸Šä½ã®ã‚³ãƒ³ãƒãƒ¼ã‚¶ãƒ–ãƒ«ã«ç§»å‹•ã™ã‚‹ã“ã¨ã‚’**çŠ¶æ…‹ãƒ›ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°**ã¨å‘¼ã³ã¾ã™ã€‚Jetpack Composeã¯ã€çŠ¶æ…‹ãŒå¤‰åŒ–ã—ãŸéš›ã«å½±éŸ¿ã‚’å—ã‘ã‚‹å­è¦ç´ ã®ã¿ã‚’å†ã‚³ãƒ³ãƒãƒ¼ã‚ºã™ã‚‹ä»•çµ„ã¿ã‚’æŒã£ã¦ãŠã‚Šã€ã“ã®ç‰¹æ€§ã«ã‚ˆã‚Šã€è¦ªã«çŠ¶æ…‹ã‚’é›†ç´„ã—ã¦ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ãŒå°‘ãªã„è¨­è¨ˆã‚’è¡Œã†ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã“ã®ç‰¹å¾´ã«ã‚ˆã‚Šã€Flutterã¨é•ã„æ¬¡ã®ã‚ˆã†ãªãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š

- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã®æ´»ç”¨ï¼šè¦ªã«çŠ¶æ…‹ã‚’é›†ç´„ã™ã‚‹ã“ã¨ã§ã€PreviewãŒæ´»ç”¨ã—ã‚„ã™ããªã‚‹ã€‚
- å†åˆ©ç”¨æ€§ã®å‘ä¸Šï¼šå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ç´”ç²‹ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãªã‚‹ãŸã‚ã€ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Šã‚„å†åˆ©ç”¨ã—ã‚„ã™ããªã‚‹ã€‚
- è²¬å‹™ã®åˆ†é›¢ï¼šè¦ªã«çŠ¶æ…‹ã‚’é›†ç´„ã—ã€çŠ¶æ…‹ã®ç®¡ç†ã¨UIãƒ­ã‚¸ãƒƒã‚¯ã‚’æ˜ç¢ºã«åˆ†é›¢ã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ã®è²¬å‹™ãŒæ˜ç¢ºã«ãªã‚Šã€å¯èª­æ€§ãŒå‘ä¸Šã™ã‚‹ã€‚

https://developer.android.com/develop/ui/compose/state-hoisting?hl=ja
https://zenn.dev/newspicks/articles/1be952d9166c19

### ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
ä»¥ä¸‹ã¯çŠ¶æ…‹ã‚’è¦ªWidgetã«é…ç½®ã—ãŸä¾‹ã§ã™ï¼š

```kotlin
@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun ParentScreen() {
    var counter1 by remember { mutableStateOf(0) }
    var counter2 by remember { mutableStateOf(0) }

    Scaffold(
        topBar = {
            TopAppBar(
                title = { Text("TopAppBar") },

                )
        },

        ) { innerPadding ->
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(innerPadding),
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.Center
        ) {
            Child1Widget(counter = counter1)
            Child2Widget(counter = counter2)
            Spacer(modifier = Modifier.height(16.dp))
            Button(onClick = { counter1++ }) {
                Text("Increment Counter 1")
            }
            Spacer(modifier = Modifier.height(8.dp))
            Button(onClick = { counter2++ }) {
                Text("Increment Counter 2")
            }
        }
    }
}

@Composable
fun Child1Widget(counter: Int) {
    println("Child1Widget recompose")
    Text(text = "child1: $counter")
}

@Composable
fun Child2Widget(counter: Int) {
    println("Child2Widget recompose")
    Text(text = "child2: $counter")
}

```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§count1ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ã¨ã€child1ã®ã¿å†ã‚³ãƒ³ãƒãƒ¼ã‚ºãŒèµ°ã‚Šã¾ã—ãŸã€‚

```
Child1Widget rebuild
```

## ã¾ã¨ã‚
Flutterã¨Jetpack Composeã®è¦ªå­é–¢ä¿‚ã«ãŠã‘ã‚‹çŠ¶æ…‹é…ç½®ã‚’ã¾ã¨ã‚ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

- **Flutter**ã§ã¯ã€çŠ¶æ…‹ã‚’æœ«ç«¯ï¼ˆå­ï¼‰ã«é…ç½®ã™ã‚‹ã“ã¨ã§ãƒªãƒ“ãƒ«ãƒ‰ã®ç¯„å›²ã‚’æœ€å°åŒ–ã€‚
- **Jetpack Compose**ã§ã¯ã€è¦ªã«çŠ¶æ…‹ã‚’é›†ç´„ã—ã¤ã¤ã€å†ã‚³ãƒ³ãƒãƒ¼ã‚ºã®å½±éŸ¿ã‚’é™å®šã€‚

å¿…ãšã—ã‚‚ä¸Šè¨˜ã®æ€æƒ³ã«å¾“ã†ã®ã§ã¯ãªãã€ã‚ãã¾ã§ã‚‚æ¨å¥¨ã¾ã§ã§ç”¨é€”ã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦æ¨¡æ„Ÿã«å¿œã˜ã¦é©åˆ‡ã«è¨­è¨ˆã‚’è¡Œãªã£ã¦ã„ãã“ã¨ãŒå¤§åˆ‡ã§ã™ã­ã€‚

## å‚è€ƒæ–‡çŒ®
https://api.flutter.dev/flutter/widgets/StatefulWidget-class.html
https://qiita.com/chooyan_eng/items/ec11f6dcf714f7a2fa3d
https://developer.android.com/develop/ui/compose/state-hoisting?hl=ja
https://zenn.dev/newspicks/articles/1be952d9166c19

[^1]: ãƒ„ãƒªãƒ¼æ§‹é€ ã®æœ«ç«¯ã«ä½ç½®ã™ã‚‹ãƒãƒ¼ãƒ‰ã®æ„å‘³

