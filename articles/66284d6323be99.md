---
title: "ğŸŒ‹flutter_hooksã®useReducerå…¥é–€"
emoji: "ğŸŒ‹"
type: "tech"
topics:
  - "flutter"
  - "dart"
  - "hooks"
  - "usereduer"
published: true
published_at: "2023-12-21 03:16"
---

https://zenn.dev/caphtech/articles/flutter-hooks-usereducer
ä¸Šè¨˜è¨˜äº‹ã‚’æ‹è¦‹ã—ã€`useReducer`ã¨ã„ã†ä¾¿åˆ©ãªHookãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’çŸ¥ã£ãŸã®ã§è»½ãè§¦ã£ã¦ã¿ã¾ã—ãŸã€‚

## useReducerã¨ã¯ï¼Ÿ
å…ˆã»ã©ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã‚‚ã‚‰ãˆã‚Œã°è©³ã—ãã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ãŒã€æœ¬è¨˜äº‹ã§ã‚‚è»½ãèª¬æ˜ã—ã¦ãŠãã¾ã™ã€‚
useReducer ã¯ã€`flutter_hooks`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã‚‹ãƒ•ãƒƒã‚¯ã®ä¸€ã¤ã§ã€è¤‡é›‘ãªçŠ¶æ…‹ç®¡ç†ã‚’åŠ¹ç‡çš„ã«è¡Œã†ãŸã‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

useReducerã®ä¸»ãªåˆ©ç‚¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

- é–¢é€£ã™ã‚‹çŠ¶æ…‹ã®ä¸€æ‹¬æ›´æ–°: è¤‡æ•°ã®é–¢é€£ã™ã‚‹çŠ¶æ…‹ã‚’ä¸€åº¦ã«æ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
- è¤‡é›‘ãªçŠ¶æ…‹ãƒ­ã‚¸ãƒƒã‚¯ã®ã‚«ãƒ—ã‚»ãƒ«åŒ–: çŠ¶æ…‹å¤‰åŒ–ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ reducer å†…ã«é›†ç´„ã—ã€ã‚³ãƒ¼ãƒ‰ã®æ•´ç†ã¨å¯èª­æ€§ã®å‘ä¸Šã‚’å›³ã‚Šã¾ã™ã€‚
- å†åˆ©ç”¨æ€§: ç´”ç²‹é–¢æ•°ã§ã‚ã‚‹ reducer ã¯ã€è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã§å†åˆ©ç”¨å¯èƒ½ã§ã™ã€‚
- ãƒ†ã‚¹ãƒˆã®å®¹æ˜“ã•: ç´”ç²‹é–¢æ•°ã§ã‚ã‚‹ãŸã‚ã€reducer ã®å˜ä½“ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚

## useReducerã‚’ä½¿ã£ã¦ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹
è¤‡é›‘ãªçŠ¶æ…‹ã‚„å‡¦ç†ã§ã¯ãªã„ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã§useReducerã‚’ä½¿ç”¨ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆã¯ãªã„ï¼ˆã‚€ã—ã‚å†—é•·ãªã®ã§ãƒ‡ãƒ¡ãƒªãƒƒãƒˆï¼‰ã¨æ€ã„ã¾ã™ãŒã€åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’å­¦ã¶ãŸã‚ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã§ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½œã‚Šã¾ã—ãŸã€‚

```dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';

class UseReducerSample extends HookWidget {
  const UseReducerSample({super.key});

  @override
  Widget build(BuildContext context) {
    final store = useReducer<State, CountAction>(
      reducer,
      initialState: State(),
      initialAction: NoAction(),
    );

    return Scaffold(
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            Text('Count: ${store.state.counter}'),
            ElevatedButton(
              onPressed: () => store.dispatch(Increment()),
              child: Text('Increment'),
            ),
            ElevatedButton(
              onPressed: () => store.dispatch(Decrement()),
              child: Text('Decrement'),
            ),
            ElevatedButton(
              onPressed: () => store.dispatch(Reset()),
              child: Text('Reset'),
            ),
            ElevatedButton(
              onPressed: () => store.dispatch(NoAction()),
              child: Text('No'),
            ),
          ],
        ),
      ),
    );
  }
}

sealed class CountAction {}

class Increment extends CountAction {}

class Decrement extends CountAction {}

class Reset extends CountAction {}

class NoAction extends CountAction {}

State reducer(State state, CountAction action) => switch (action) {
      Increment() => State(counter: state.counter + 1),
      Decrement() => State(counter: state.counter - 1),
      Reset() => State(counter: 0),
      NoAction() => state,
    };

class State {
  State({this.counter = 0});
  final int counter;
}

```

![](https://storage.googleapis.com/zenn-user-upload/c42a7acc97fb-20231221.gif =300x)

æ³¨ç›®ã™ã¹ãç‚¹ã¯`useReducer`éƒ¨åˆ†ã§ã™ã€‚

```dart
    final store = useReducer<State, CountAction>(
      reducer,
      initialState: State(),
      initialAction: NoAction(),
    );
```
<State, CountAction>éƒ¨åˆ†ã§ã€Stateã¯ç®¡ç†ã™ã‚‹çŠ¶æ…‹ã‚¯ãƒ©ã‚¹ãŒæŒ‡å®šã•ã‚Œã€CountActionã¯çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ã™åŸºåº•ã‚¯ãƒ©ã‚¹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚`useReducer`ã§ã¯ã€ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’dispatchï¼ˆç™ºè¡Œï¼‰ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦çŠ¶æ…‹ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```dart
sealed class CountAction {}

class Increment extends CountAction {}

class Decrement extends CountAction {}

class Reset extends CountAction {}

class NoAction extends CountAction {}
```
Dart3ã‹ã‚‰å°å…¥ã•ã‚ŒãŸ`sealed`ã‚¯ãƒ©ã‚¹ã‚’åŸºåº•ã‚¯ãƒ©ã‚¹ã¨ã—ã€ãã‚Œãã‚Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã§ç¶™æ‰¿ã—ã¦ã„ã¾ã™ã€‚

```dart
State reducer(State state, CountAction action) => switch (action) {
      Increment() => State(counter: state.counter + 1),
      Decrement() => State(counter: state.counter - 1),
      Reset() => State(counter: 0),
      NoAction() => state,
    };
```
reduceré–¢æ•°ã§ã¯å—ã‘å–ã£ãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã«ã‚ˆã£ã¦è¿”å´ã™ã‚‹çŠ¶æ…‹ã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚ã“ã®reducerã‚’`useReducer`ã®ç¬¬ä¸€å¼•æ•°ã«æŒ‡å®šã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€çŠ¶æ…‹ã®å¤‰æ›´ã‚’Viewã«é€šçŸ¥ã—ã¾ã™ã€‚

å®Ÿéš›ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹éš›ã«ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«å®Ÿè¡Œã—ã¾ã™ã€‚

```dart
final store = useReducer<State, CountAction>(
  reducer,
  initialState: State(),
  initialAction: NoAction(),
);
    
 ãƒ»ãƒ»ãƒ»
 
ElevatedButton(
  onPressed: () => store.dispatch(Increment()),
  child: Text('Increment'),
),
```

initialState ã¯ã€ãƒ•ãƒƒã‚¯ãŒæœ€åˆã«ä½¿ç”¨ã•ã‚Œã‚‹ã¨ãã®åˆæœŸå€¤ã§ã€ã“ã“ã§ã¯State() ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã€åˆæœŸçŠ¶æ…‹ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚

```dart
class State {
  State({this.counter = 0});
  final int counter;
}
```

initialAction ã¯ã€ãƒ•ãƒƒã‚¯ãŒåˆã‚ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã¨ãã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã™ã€‚NoAction() ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§ã€ç‰¹ã«ãªã‚“ã®å¤‰æ›´ã‚‚è¡Œã„ã¾ã›ã‚“ã€‚

```dart
NoAction() => state, â† ãã®ã¾ã¾stateã‚’è¿”å´ã—ã¦ã„ã¾ã™ã€‚
```

## ãƒ†ã‚¹ãƒˆã‚’æ›¸ã

`useState`ã‚’ä½¿ã£ãŸã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã®å ´åˆã€[flutter_hooks_test](https://pub.dev/packages/flutter_hooks_test)ã¨ã„ã£ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†å¿…è¦ãŒã‚ã£ãŸã‚Šã€çŠ¶æ…‹ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒã‚¦ã‚£ã‚¸ãƒƒãƒˆã¨å¯†æ¥ã«é–¢ã‚ã£ã¦ã„ã‚‹ãŸã‚ç´”ç²‹ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ãŒé›£ã—ã„ã§ã™ã€‚ã—ã‹ã—ã€useReducerã§reduceré–¢æ•°ã‚’å®šç¾©ã—ã¦ã„ã‚‹å ´åˆã€reduceré–¢æ•°ã‚’ç´”ç²‹ãªé–¢æ•°ã¨ã—ã¦å®šç¾©ã—ã¦ã„ã‚‹ã®ã§ã€ãƒ†ã‚¹ãƒˆã‚’ç°¡å˜ã«æ›¸ãã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

```dart
void main() {
  group('Reducerãƒ†ã‚¹ãƒˆ', () {
    test('ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’å¢—åŠ ', () {
      final initialState = State(counter: 0);
      final newState = reducer(initialState, Increment());

      expect(newState.counter, 1);
    });

    test('ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’æ¸›å°‘', () {
      final initialState = State(counter: 0);
      final newState = reducer(initialState, Decrement());

      expect(newState.counter, -1);
    });

    test('ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ', () {
      final initialState = State(counter: 5);
      final newState = reducer(initialState, Reset());

      expect(newState.counter, 0);
    });

    test('å¤‰æ›´ã—ãªã„', () {
      final initialState = State(counter: 3);
      final newState = reducer(initialState, NoAction());

      expect(newState.counter, 3);
    });
  });
}

```

## ã¾ã¨ã‚
`useReducer`ã‚’ã†ã¾ãæ´»ç”¨ã™ã‚Œã°ã€ãƒ¦ãƒ¼ã‚¶æƒ…å ±å…¥åŠ›ç”»é¢ã®ã‚ˆã†ã«è¤‡é›‘ãªãƒ•ã‚©ãƒ¼ãƒ ã®çŠ¶æ…‹ç®¡ç†ã‚„ECã‚¢ãƒ—ãƒªã®ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆã®çŠ¶æ…‹ç®¡ç†ç­‰ã‚’ç°¡æ½”ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚è‡ªåˆ†è‡ªèº«ã€ã¾ã ã•ã‚‰ã£ã¨è©¦ã—ãŸãã‚‰ã„ãªã®ã§ã“ã‚Œã‹ã‚‰æ´»ç”¨ã—ã¦`useReducer`ã®çŸ¥è­˜ã‚’æ·±ã‚ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚
