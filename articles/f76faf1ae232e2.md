---
title: "ğŸ§‘â€ğŸ§‘â€ğŸ§’ Riverpodã®.familyãªProviderã‚’å¼•æ•°ã«ä¾å­˜ã›ãšç›£è¦–ã™ã‚‹"
emoji: "ğŸ‘ª"
type: "tech"
topics:
  - "flutter"
  - "dart"
  - "riverpod"
  - "provider"
  - "family"
published: false
---

## ã¯ã˜ã‚ã«
æœ¬æ¥­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã€`å¼•æ•°ã«é–¢ä¿‚ãªãç‰¹å®šã®.familyãªproviderãŒç™ºç«ã—ãŸã‚‰ç‰¹å®šã®å…±é€šå‡¦ç†ã‚’è¡Œã„ãŸã„ï¼`ã¨ã„ã†è¦ä»¶ãŒã‚ã£ãŸãŸã‚ã€ã‚‚ã—åŒæ§˜ã®è¦ä»¶ã§æ‚©ã‚“ã§ã„ã‚‹äººãŒã„ãŸã‚‰å‚è€ƒã«ãªã‚Œã°ã¨æ€ã„ã€è¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸã€‚

:::message
ä»¥é™`.familyãªProvider`ã¨æ›¸ãã¨é•·ããªã‚‹ãŸã‚ã€`family`ã¨è¨˜è¼‰ã—ã¾ã™ã€‚
:::

:::message
ä»Šå›ã¯riverpodã®æ›¸ãæ–¹ã«ã¤ã„ã¦ã¯è¨€åŠã—ã¾ã›ã‚“ãŒã€riverpod generatorã‚’ä½¿ç”¨ã™ã‚‹å‰æã§æ›¸ã„ã¦ã„ã¾ã™ã€‚
:::

## ã€€å‰æï¼ˆfamilyã«ç†è§£ãŒã‚ã‚‹æ–¹ã¯èª­ã¿é£›ã°ã—ã¦ãã ã•ã„ï¼‰
riverpodã®providerã®æ›´æ–°çŠ¶æ³ã‚’ç›£è¦–ã—ã€ä½•ã‹å‡¦ç†ã‚’è¡Œã„ãŸã„å ´åˆã¯`ref.listen`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

```dart
ref.listen(provider, (prev, next) {});
```

familyã«é–¢ã—ã¦ã‚‚æ¼ã‚Œãªã`ref.listen`ã§ã®ç›£è¦–ãŒå¯èƒ½ã§ã€ä¸‹è¨˜ã®ã‚ˆã†ã«å¼•æ•°ã«å€¤ã‚’æŒ‡å®šã—ã¦ç›£è¦–ã‚’è¡Œã„ã¾ã™ã€‚
```dart
@riverpod
int count(Ref ref, int defaultValue) => 0;
ref.listen(countProvider(2), (prev, next) {});
```
ã—ã‹ã—ã€familyã®å¼•æ•°ãŒç•°ãªã‚‹å ´åˆã€ãã‚Œãã‚Œã®providerã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ç•°ãªã‚‹ãŸã‚ã€`ref.listen`ã«ã‚‚åŒã˜å¼•æ•°ã‚’æ¸¡ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```dart
@riverpod
class Count extends _$Count {
  @override
  int build(int value) => 0;

  void update(int value) => state = value;
}
// å¼•æ•°ã«1ã‚’æŒ‡å®šã—ã¦ãŠã‚Šã€updateã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹Providerã®å¼•æ•°ã«1ä»¥å¤–ã‚’æ¸¡ã—ã¦ã„ã‚‹å ´åˆã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç™ºç«ã—ãªã„ã€‚
ref.listen(countProvider(1), (prev, next) {
  print('ç™ºç«');
});
// ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒç™ºç«ã™ã‚‹
ref.read(countProvider(1).notifier).update(1);
// ç™ºç«ã—ãªã„
ref.read(countProvider(2).notifier).update(2);
```
https://riverpod.dev/ja/docs/concepts/modifiers/family

## ä»Šå›ã®è¦ä»¶
æœ¬æ¥­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€usecaseçš„ã«providerã‚’å®šç¾©ã—ã¦ãŠã‚Šã€APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å…ƒã«`ref.listen`ã‚’æ‹¡å¼µã—ãŸlistenã§å…±é€šã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

```dart
ref.customListen(provider, onSuccess: (data) {});

extension WidgetRefExt on WidgetRef {
  void cunstomListen<T>(
    ProviderListenable<AsyncValue<T>>, {
      required BuildContext context,
      FutureOr<void> Function(T value)? onSuccess,
      FutureOr<void> Function(Object error, StackTrace? stackTrace)? onError,
    }
  ) {
    listen<AsyncValue<T>>(provider, (prev, next) {
      next.when(
        data: (data) {}
        loading: () {}
        error: (error, stackTrace) {
        // ã“ã“ã§å…±é€šã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚„ã‚¨ãƒ©ãƒ¼ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºã‚’è¡Œã„ãŸã„ã€‚
        }
      )
    })
  }
}
```
familyproviderã‚‚åŒæ§˜ã«ä¸Šè¨˜ã®customListenã‚’ä½¿ã„ãŸã„ã¨ã“ã‚ã§ã™ãŒã€ä»Šå›ã®è¦ä»¶ãŒ`å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§å—ã‘å–ã£ãŸå€¤ã‚’å…ƒã«APIé€šä¿¡ã‚’è¡Œã„ã€ãã®çµæœã‚’ã‚‚ã¨ã«å…±é€šå‡¦ç†ã‚’å®Ÿè¡Œã—ãŸã„`ãŸã‚ã€`ref.listen`ã§åŒã˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®providerã‚’ç™ºç«ã•ã›ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
```dart
@riverpod
class Usecase extends _$Usecase {
  @override
  Future<String?> build(int value) => null;

  void execute() {
    // APIã‚’å®Ÿè¡Œã—ã¦stateã‚’æ›´æ–°
  };
}

class SamplePage extends ConsumerWidget {
  const SamplePage({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    ref.customListe(
      // 
      usecaseProvider(1),
      onSuccess: (data) {
        // AsyncDataãŒã®å ´åˆã®å‡¦ç†
      }
    );

    return Scaffold(
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            ChildComponent(
              callback: (value) {
                // ã“ã“ã§å—ã‘å–ã£ãŸå€¤ã®providerã«å¯¾ã—ã¦å‡¦ç†ã‚’è¡Œã„ãŸã„ã€‚
                ref.read(usecaseProvider(value).notifier).execute();
              },
            ),
          ],
        ),
      ),
    );
  }
}
```

`ref.listen`ã§è¡Œãªã£ã¦ã‚‹å…±é€šå‡¦ç†ã‚’é–¢æ•°åŒ–ã—ã¦ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å†…ã§è¨˜è¿°ã™ã‚Œã°å•é¡Œãªãå‡¦ç†ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã™ãŒã€ã§ãã‚Œã°riverpodã®æ©Ÿèƒ½ã‚’æ´»ã‹ã—ã¦å‘½ä»¤çš„ã«ã§ã¯ãªãå‰¯ä½œç”¨çš„ã«å…±é€šå‡¦ç†ã‚’ç™ºç«ã•ã›ãŸã„ã¨ã“ã‚ã§ã™ã€‚

:::message
ã¶ã£ã¡ã‚ƒã‘familyã®`ref.customListen`ã‚’å­ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ç§»è¡Œã—ã¦ã€å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«æ¸¡ã›ã°è§£æ±ºã™ã‚‹è©±ã§ã¯ã‚ã‚Šã¾ã™ãŒã€ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å¤§ããå¤‰ãˆã¦ã—ã¾ã†ãŸã‚è¦‹é€ã‚Šã¾ã—ãŸã€‚
:::

## è§£æ±ºæ–¹æ³•
`listeManual`ã‚’æ‹¡å¼µã—ã¦è§£æ±ºã—ã¾ã—ãŸã€‚
https://github.com/rrousselGit/riverpod/blob/288c9b53e308f902f6309eba1c173bf745e0cfaa/packages/flutter_riverpod/lib/src/consumer.dart#L98

`listenManual`ã¯
ï¼ˆå­˜åœ¨è‡ªä½“ã¯çŸ¥ã£ã¦ã„ã¾ã—ãŸãŒã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãŒåˆ†ã‹ã‚‰ãšä½¿ç”¨ã—ã¦ã„ãªã‹ã£ãŸãŸã‚ä»Šå›ä½¿ç”¨ã§ãã¦å¬‰ã—ã„..ï¼‰